#!/usr/bin/env bash
set -euo pipefail

# Stop the user service that was inhibiting the lid switch.

UNIT="disable-lid-switch.service"

# Try to stop the transient unit unconditionally (ignore errors)
systemctl --user stop "$UNIT" >/dev/null 2>&1 || true

# If it somehow lingers, try a kill
systemctl --user kill "$UNIT" >/dev/null 2>&1 || true

# Clear failed state quietly if present
systemctl --user reset-failed "$UNIT" >/dev/null 2>&1 || true

# As a last resort, kill a matching inhibitor process owned by this user
pkill -u "$USER" -f "systemd-inhibit.*handle-lid-switch.*Temporarily disable lid close sleep for 3 hours" >/dev/null 2>&1 || true

exit 0
